# Kubernetes Monitoring and Init Containers

## Task 1

### Overview of kube-prometheus-stack

The Kube Prometheus Stack, often used for monitoring Kubernetes clusters, consists of several key components. These components work together to provide a comprehensive monitoring solution. Here's a brief overview of each:

1. Prometheus: the core component, Prometheus is an open-source monitoring system with a dimensional data model, flexible query language, efficient time series database, and modern alerting approach.

2. Grafana: Grafana is a popular open-source analytics and interactive visualization web application. It provides charts, graphs, and alerts when connected to supported data sources, including Prometheus.

3. Alertmanager: this component of Prometheus handles alerts sent by client applications such as the Prometheus server. It takes care of deduplicating, grouping, and routing them to the correct receiver integrations such as email, PagerDuty, or OpsGenie.

4. Kube State Metrics: an essential service which provides cluster state metrics gleaned from the Kubernetes API server.

5. Prometheus Operator: simplifies the deployment and configuration of Prometheus, Alertmanager, and related monitoring components.

### Deploying

```bash
helm install mon prometheus-community/kube-prometheus-stack
NAME: mon
LAST DEPLOYED: Thu Nov 16 07:02:02 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
kube-prometheus-stack has been installed. Check its status by running:
  kubectl --namespace default get pods -l "release=mon"

Visit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create & configure Alertmanager and Prometheus instances using the Operator.
```

```bash
kubectl get po,sts,svc,pvc,cm
NAME                                                        READY   STATUS    RESTARTS        AGE
pod/alertmanager-mon-kube-prometheus-stack-alertmanager-0   2/2     Running   0               5m42s
pod/mon-grafana-7c99d9cd55-f8p8n                            3/3     Running   3 (2m14s ago)   6m35s
pod/mon-kube-prometheus-stack-operator-6b89779fcb-wpr8c     1/1     Running   0               6m35s
pod/mon-kube-state-metrics-7664788db5-96jvv                 1/1     Running   0               6m35s
pod/mon-prometheus-node-exporter-zpgh6                      1/1     Running   0               6m35s
pod/prometheus-mon-kube-prometheus-stack-prometheus-0       2/2     Running   0               5m41s

NAME                                                                   READY   AGE
statefulset.apps/alertmanager-mon-kube-prometheus-stack-alertmanager   1/1     5m42s
statefulset.apps/prometheus-mon-kube-prometheus-stack-prometheus       1/1     5m42s

NAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                    ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   5m42s
service/kubernetes                               ClusterIP   10.96.0.1        <none>        443/TCP                      8m19s
service/mon-grafana                              ClusterIP   10.96.154.26     <none>        80/TCP                       6m36s
service/mon-kube-prometheus-stack-alertmanager   ClusterIP   10.111.78.238    <none>        9093/TCP,8080/TCP            6m36s
service/mon-kube-prometheus-stack-operator       ClusterIP   10.107.241.225   <none>        443/TCP                      6m36s
service/mon-kube-prometheus-stack-prometheus     ClusterIP   10.106.215.190   <none>        9090/TCP,8080/TCP            6m36s
service/mon-kube-state-metrics                   ClusterIP   10.103.187.163   <none>        8080/TCP                     6m36s
service/mon-prometheus-node-exporter             ClusterIP   10.101.77.175    <none>        9100/TCP                     6m35s
service/prometheus-operated                      ClusterIP   None             <none>        9090/TCP                     5m42s

NAME                                                                    DATA   AGE
configmap/kube-root-ca.crt                                              1      8m4s
configmap/mon-grafana                                                   1      6m36s
configmap/mon-grafana-config-dashboards                                 1      6m36s
configmap/mon-kube-prometheus-stack-alertmanager-overview               1      6m36s
configmap/mon-kube-prometheus-stack-apiserver                           1      6m36s
configmap/mon-kube-prometheus-stack-cluster-total                       1      6m36s
configmap/mon-kube-prometheus-stack-controller-manager                  1      6m36s
configmap/mon-kube-prometheus-stack-etcd                                1      6m36s
configmap/mon-kube-prometheus-stack-grafana-datasource                  1      6m36s
configmap/mon-kube-prometheus-stack-grafana-overview                    1      6m36s
configmap/mon-kube-prometheus-stack-k8s-coredns                         1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-cluster               1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-multicluster          1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-namespace             1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-node                  1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-pod                   1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-workload              1      6m36s
configmap/mon-kube-prometheus-stack-k8s-resources-workloads-namespace   1      6m36s
configmap/mon-kube-prometheus-stack-kubelet                             1      6m36s
configmap/mon-kube-prometheus-stack-namespace-by-pod                    1      6m36s
configmap/mon-kube-prometheus-stack-namespace-by-workload               1      6m36s
configmap/mon-kube-prometheus-stack-node-cluster-rsrc-use               1      6m36s
configmap/mon-kube-prometheus-stack-node-rsrc-use                       1      6m36s
configmap/mon-kube-prometheus-stack-nodes                               1      6m36s
configmap/mon-kube-prometheus-stack-nodes-darwin                        1      6m36s
configmap/mon-kube-prometheus-stack-persistentvolumesusage              1      6m36s
configmap/mon-kube-prometheus-stack-pod-total                           1      6m36s
configmap/mon-kube-prometheus-stack-prometheus                          1      6m36s
configmap/mon-kube-prometheus-stack-proxy                               1      6m36s
configmap/mon-kube-prometheus-stack-scheduler                           1      6m36s
configmap/mon-kube-prometheus-stack-workload-total                      1      6m36s
configmap/prometheus-mon-kube-prometheus-stack-prometheus-rulefiles-0   29     5m42s
```

Pods

1. pod/alertmanager-mon-kube-prometheus-stack-alertmanager-0: The Alertmanager pod, part of the Prometheus stack, responsible for handling alerts.
2. pod/mon-grafana-7c99d9cd55-f8p8n: The Grafana pod, used for visualization of metrics.
3. pod/mon-kube-prometheus-stack-operator-6b89779fcb-wpr8c: The Prometheus Operator pod, simplifying deployment and management of Prometheus and related monitoring components.
4. pod/mon-kube-state-metrics-7664788db5-96jvv: The Kube State Metrics pod, providing metrics about the state of Kubernetes objects.
5. pod/mon-prometheus-node-exporter-zpgh6: The Node Exporter pod, collecting hardware and OS metrics.
6. pod/prometheus-mon-kube-prometheus-stack-prometheus-0: The Prometheus pod, central to the Prometheus monitoring stack.

Stateful Sets

1. statefulset.apps/alertmanager-mon-kube-prometheus-stack-alertmanager: Manages deployment and scaling of the Alertmanager instance.
2. statefulset.apps/prometheus-mon-kube-prometheus-stack-prometheus: Manages deployment and scaling of the Prometheus instance.

Services

Various service entries represent the network services exposing the Prometheus stack components, such as Grafana, Alertmanager, Prometheus, Kube State Metrics, and Node Exporter.

ConfigMaps

Multiple configmap entries, containing configuration data and Prometheus rules. These are crucial for defining how Prometheus monitors environment and how Grafana dashboards are configured.
This output indicates a healthy state of monitoring stack, with all pods running and services properly exposed. The numerous configmaps suggest a well-defined set of rules and dashboards, essential for effective monitoring.

### Testing access

```bash
kubectl port-forward svc/mon-grafana 8080:80
Forwarding from 127.0.0.1:8080 -> 3000
Forwarding from [::1]:8080 -> 3000
Handling connection for 8080
```


